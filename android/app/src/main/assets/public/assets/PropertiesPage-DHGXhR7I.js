import{ar as re,r as g,b as Z,V as se,S as ne,p as ie,W as K,X as t,ad as h,ab as s,Y as e,a3 as k,$ as n,Z as m,as as Y,aj as B,ak as L,k as _,ap as j,at as V,au as ue,av as x,aw as Q,ai as E,ax as ee,a1 as de,ay as pe,ag as v,ao as O,a7 as ce,a6 as me,al as ve,_ as c,a5 as le,a2 as ae,ae as S,af as f,a4 as y,am as fe}from"./index-D0a3PjNi.js";import{Q as te}from"./QBadge-Bt5SIest.js";import{Q as ye}from"./QPage-BSv_0Jxy.js";import{u as be}from"./use-quasar-BtzAyJjx.js";import{u as ge}from"./useFirestore-C2-a9jAw.js";import{w as we}from"./firebase-KNU8sfuI.js";import{u as he}from"./vue-i18n.runtime-Brl3r92v.js";const $e=re("property",()=>{const F=g([]),i=g(!1),$=g(null),{getAll:P,getById:R,add:A,update:I,remove:C,queryDocuments:r}=ge("properties"),T=Z(()=>F.value.length),W=Z(()=>F.value.slice(0,3)),w=async()=>{i.value=!0;try{F.value=await P()}catch(u){console.error("Error loading properties:",u),$.value="Failed to load properties"}finally{i.value=!1}};return{properties:F,loading:i,error:$,totalProperties:T,featuredProperties:W,loadProperties:w,getProperty:async u=>await R(u),addProperty:async u=>{const b={...u,createdAt:new Date,updatedAt:new Date},p=await A(b);return p?(await w(),p):null},updateProperty:async(u,b)=>{const p={...b,updatedAt:new Date},q=await I(u,p);return q&&await w(),q},deleteProperty:async u=>{const b=await C(u);return b&&await w(),b},searchProperties:async(u,b)=>{i.value=!0;try{const p=[];b&&p.push(we("type","==",b));const q=await r(...p);if(u){const D=u.toLowerCase();return q.filter(N=>N.ownerName.toLowerCase().includes(D)||N.location.toLowerCase().includes(D)||N.description.toLowerCase().includes(D)||N.type.toLowerCase().includes(D))}return q}catch(p){return console.error("Error searching properties:",p),$.value="Failed to search properties",[]}finally{i.value=!1}}}}),_e={class:"q-mb-lg"},Ve={class:"row justify-between items-center"},Pe={class:"text-h4 q-my-none"},Ce={class:"text-h6"},qe={class:"q-mb-md"},Ne={class:"q-mb-sm"},ke={class:"row items-center"},Qe={key:0,class:"col-12 col-sm-4 q-pr-sm q-mb-sm"},Ue={class:"absolute-top-right q-pa-xs"},De={class:"q-mb-md"},Le={class:"row q-col-gutter-sm"},Se={class:"col-12 col-sm-6 col-md-3"},Fe={key:0,class:"text-center q-pa-lg"},Ie={class:"text-subtitle1 q-mt-sm"},Te={key:1,class:"row q-col-gutter-md"},ze={class:"property-badge"},Ae={class:"property-type-badge"},Be={class:"property-header"},je={class:"text-subtitle1 property-location text-weight-bold"},Ee={class:"row items-center q-mt-sm"},Oe={class:"text-caption"},Re={class:"text-caption"},We={key:0,class:"text-body2 ellipsis-2-lines property-description"},Me={class:"text-h6"},Xe={key:0,class:"q-mb-md"},Ye={class:"row q-col-gutter-md"},Ze={class:"col-12 col-md-6"},Ge={class:"col-12 col-md-6"},He={class:"text-subtitle2"},Je={class:"q-ml-sm"},rl=se({__name:"PropertiesPage",setup(F){const{t:i}=he(),$=be(),P=g(!1),R=l=>{X(),u.value=!1,P.value=!0},A=[{label:i("properties.house"),value:i("properties.house")},{label:i("properties.apartment"),value:i("properties.apartment")},{label:i("properties.building"),value:i("properties.building")},{label:i("properties.land"),value:i("properties.land")}],I=l=>l?typeof l=="object"&&l!==null?l.label||"":l:"",C=$e(),r=ne({id:"0",type:"",ownerName:"",phoneNumber:"",area:0,location:"",price:"",description:"",image:null}),T=g(null),W=l=>{if(!l)return;const o=new FileReader;o.onload=a=>{r.image=a.target?.result},o.readAsDataURL(l)};ie(async()=>{await C.loadProperties()});const w=g(""),z=g(null),M=Z(()=>{let l=[...C.properties];if(w.value){const o=w.value.toLowerCase();l=l.filter(a=>a.ownerName.toLowerCase().includes(o)||a.location.toLowerCase().includes(o)||a.description.toLowerCase().includes(o)||a.type.toLowerCase().includes(o))}return z.value&&(l=l.filter(o=>o.type===z.value)),l}),U=g(!1),d=g(null),G=l=>{d.value=l,U.value=!0},u=g(!1),b=l=>{Object.assign(r,l),u.value=!0,U.value=!1},p=g(!1),q=()=>{p.value=!0},D=async()=>{d.value&&await C.deleteProperty(d.value.id)&&($.notify({color:"positive",message:i("properties.propertyDeleted"),icon:"check"}),U.value=!1),p.value=!1},N=async()=>{u.value?await C.updateProperty(r.id,{type:r.type,ownerName:r.ownerName,phoneNumber:r.phoneNumber,area:Number(r.area),location:r.location,price:r.price,description:r.description,image:r.image})&&$.notify({color:"positive",message:i("properties.propertyUpdated"),icon:"check"}):await C.addProperty({type:r.type,ownerName:r.ownerName,phoneNumber:r.phoneNumber,area:Number(r.area),location:r.location,price:r.price,description:r.description,image:r.image})&&$.notify({color:"positive",message:i("properties.propertyAdded"),icon:"check"}),X(),P.value=!1},X=()=>{Object.assign(r,{id:"0",type:"",ownerName:"",phoneNumber:"",area:0,location:"",price:"",description:"",image:null}),T.value=null,u.value=!1},H=()=>{X(),P.value=!1};function J(l){window.location.href=`tel:${l}`,$.notify({color:"green-5",textColor:"white",icon:"phone",message:i("properties.call")+": "+l})}return(l,o)=>(h(),K(ye,{padding:""},{default:t(()=>[s("div",_e,[s("div",Ve,[s("h1",Pe,n(l.$t("properties.title")),1),e(m,{color:"primary",label:l.$t("properties.addProperty"),onClick:o[0]||(o[0]=a=>R()),icon:"add",unelevated:""},null,8,["label"])])]),e(Y,{modelValue:P.value,"onUpdate:modelValue":o[10]||(o[10]=a=>P.value=a),persistent:""},{default:t(()=>[e(B,{style:{width:"700px","max-width":"90vw"}},{default:t(()=>[e(L,{class:"row items-center"},{default:t(()=>[s("div",Ce,n(u.value?l.$t("properties.edit"):l.$t("properties.addProperty")),1),e(j),_(e(m,{icon:"close",flat:"",round:"",dense:"",onClick:H},null,512),[[V]])]),_:1}),e(L,{class:"q-pt-none"},{default:t(()=>[e(ue,{onSubmit:N,class:"q-gutter-md"},{default:t(()=>[e(x,{modelValue:r.type,"onUpdate:modelValue":o[1]||(o[1]=a=>r.type=a),options:A,label:l.$t("properties.propertyType")+" *",outlined:"",rules:[a=>!!a||l.$t("common.required")]},null,8,["modelValue","label","rules"]),e(Q,{modelValue:r.ownerName,"onUpdate:modelValue":o[2]||(o[2]=a=>r.ownerName=a),label:l.$t("properties.ownerName")+" *",outlined:"",rules:[a=>!!a||l.$t("common.required")]},null,8,["modelValue","label","rules"]),e(Q,{modelValue:r.phoneNumber,"onUpdate:modelValue":o[3]||(o[3]=a=>r.phoneNumber=a),label:l.$t("properties.phoneNumber")+" *",outlined:"",type:"tel",rules:[a=>!!a||l.$t("common.required"),a=>/^[+]?[\d\s-]{8,}$/.test(a)||l.$t("common.invalidPhone")]},null,8,["modelValue","label","rules"]),e(Q,{modelValue:r.area,"onUpdate:modelValue":o[4]||(o[4]=a=>r.area=a),modelModifiers:{number:!0},label:l.$t("properties.area")+" *",outlined:"",type:"number",rules:[a=>!!a||l.$t("common.required"),a=>a>0||l.$t("common.invalidNumber")]},null,8,["modelValue","label","rules"]),e(Q,{modelValue:r.location,"onUpdate:modelValue":o[5]||(o[5]=a=>r.location=a),label:l.$t("properties.location")+" *",outlined:"",rules:[a=>!!a||l.$t("common.required")]},null,8,["modelValue","label","rules"]),e(Q,{modelValue:r.price,"onUpdate:modelValue":o[6]||(o[6]=a=>r.price=a),label:l.$t("properties.price")+" *",outlined:"",rules:[a=>!!a||l.$t("common.required")]},null,8,["modelValue","label","rules"]),e(Q,{modelValue:r.description,"onUpdate:modelValue":o[7]||(o[7]=a=>r.description=a),label:l.$t("properties.description"),outlined:"",type:"textarea",rows:"3"},null,8,["modelValue","label"]),s("div",qe,[s("p",Ne,n(l.$t("properties.image")),1),s("div",ke,[r.image?(h(),k("div",Qe,[e(ee,{src:r.image,style:{height:"150px","border-radius":"var(--border-radius)"}},{default:t(()=>[s("div",Ue,[e(m,{round:"",color:"negative",icon:"delete",size:"sm",onClick:o[8]||(o[8]=a=>r.image=null)})])]),_:1},8,["src"])])):E("",!0),s("div",{class:de(["col-12",{"col-sm-8":r.image}])},[e(pe,{modelValue:T.value,"onUpdate:modelValue":[o[9]||(o[9]=a=>T.value=a),W],label:l.$t("properties.uploadImage"),outlined:"",accept:"image/*"},{prepend:t(()=>[e(v,{name:"image"})]),_:1},8,["modelValue","label"])],2)])])]),_:1})]),_:1}),e(O,{align:"right"},{default:t(()=>[_(e(m,{label:l.$t("common.cancel"),color:"grey-7",flat:"",onClick:H},null,8,["label"]),[[V]]),e(m,{label:l.$t("common.save"),color:"primary",onClick:N,unelevated:""},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s("div",De,[e(Q,{modelValue:w.value,"onUpdate:modelValue":o[11]||(o[11]=a=>w.value=a),placeholder:l.$t("common.search"),outlined:"",dense:"",clearable:"",class:"q-mb-sm"},{append:t(()=>[e(v,{name:"search"})]),_:1},8,["modelValue","placeholder"]),s("div",Le,[s("div",Se,[e(x,{modelValue:z.value,"onUpdate:modelValue":o[12]||(o[12]=a=>z.value=a),options:[{label:l.$t("common.all"),value:null},...A],label:l.$t("properties.propertyType"),outlined:"",dense:"","emit-value":"","map-options":""},null,8,["modelValue","options","label"])])])]),M.value.length===0?(h(),k("div",Fe,[e(v,{name:"apartment",size:"4rem",color:"grey-5"}),s("p",Ie,n(l.$t("common.noResults")),1)])):(h(),k("div",Te,[(h(!0),k(ce,null,me(M.value,a=>(h(),k("div",{key:a.id,class:"col-12 col-sm-6 col-md-4"},[e(B,{class:"property-card"},{default:t(()=>[s("div",{class:"property-image",style:ve(a.image?`background-image: url(${a.image})`:"")},[a.image?E("",!0):(h(),K(v,{key:0,name:"apartment",size:"4rem",class:"no-image-placeholder"})),s("div",ze,[e(te,{color:"primary",class:"text-bold text-subtitle1 price-badge"},{default:t(()=>[c(n(a.price)+" $ ",1)]),_:2},1024)]),s("div",Ae,[e(te,{color:"dark",class:"text-bold"},{default:t(()=>[c(n(I(a.type)),1)]),_:2},1024)])],4),e(L,{class:"property-content q-pa-md"},{default:t(()=>[s("div",Be,[s("div",je,n(a.location),1),s("div",Ee,[e(v,{name:"straighten",size:"xs",color:"primary",class:"q-mr-xs"}),s("span",Oe,n(a.area)+" mÂ²",1),e(j),e(v,{name:"person",size:"xs",color:"primary",class:"q-mr-xs"}),s("span",Re,n(a.ownerName),1)])]),e(le,{class:"q-my-sm"}),a.description?(h(),k("div",We,n(a.description),1)):E("",!0)]),_:2},1024),e(O,{class:"property-actions"},{default:t(()=>[e(m,{flat:"",color:"primary",label:l.$t("properties.details"),onClick:oe=>G(a)},null,8,["label","onClick"]),e(j),e(m,{round:"",color:"green",icon:"phone",class:"call-btn",size:"sm",onClick:oe=>J(a.phoneNumber)},null,8,["onClick"])]),_:2},1024)]),_:2},1024)]))),128))])),e(Y,{modelValue:U.value,"onUpdate:modelValue":o[15]||(o[15]=a=>U.value=a),persistent:""},{default:t(()=>[e(B,{style:{width:"700px","max-width":"90vw"}},{default:t(()=>[e(L,{class:"row items-center"},{default:t(()=>[s("div",Me,n(I(d.value?.type))+" - "+n(d.value?.location),1),e(j),_(e(m,{icon:"close",flat:"",round:"",dense:""},null,512),[[V]])]),_:1}),e(L,null,{default:t(()=>[d.value?.image?(h(),k("div",Xe,[e(ee,{src:d.value.image,style:{height:"250px","border-radius":"var(--border-radius)"}},null,8,["src"])])):E("",!0),s("div",Ye,[s("div",Ze,[e(ae,null,{default:t(()=>[e(S,null,{default:t(()=>[e(f,{avatar:""},{default:t(()=>[e(v,{name:"person",color:"primary"})]),_:1}),e(f,null,{default:t(()=>[e(y,{caption:""},{default:t(()=>[c(n(l.$t("properties.ownerName")),1)]),_:1}),e(y,null,{default:t(()=>[c(n(d.value?.ownerName),1)]),_:1})]),_:1})]),_:1}),e(S,null,{default:t(()=>[e(f,{avatar:""},{default:t(()=>[e(v,{name:"phone",color:"primary"})]),_:1}),e(f,null,{default:t(()=>[e(y,{caption:""},{default:t(()=>[c(n(l.$t("properties.phoneNumber")),1)]),_:1}),e(y,null,{default:t(()=>[c(n(d.value?.phoneNumber),1)]),_:1})]),_:1})]),_:1}),e(S,null,{default:t(()=>[e(f,{avatar:""},{default:t(()=>[e(v,{name:"straighten",color:"primary"})]),_:1}),e(f,null,{default:t(()=>[e(y,{caption:""},{default:t(()=>[c(n(l.$t("properties.area")),1)]),_:1}),e(y,null,{default:t(()=>[c(n(d.value?.area)+" mÂ²",1)]),_:1})]),_:1})]),_:1})]),_:1})]),s("div",Ge,[e(ae,null,{default:t(()=>[e(S,null,{default:t(()=>[e(f,{avatar:""},{default:t(()=>[e(v,{name:"home",color:"primary"})]),_:1}),e(f,null,{default:t(()=>[e(y,{caption:""},{default:t(()=>[c(n(l.$t("properties.propertyType")),1)]),_:1}),e(y,null,{default:t(()=>[c(n(I(d.value?.type)),1)]),_:1})]),_:1})]),_:1}),e(S,null,{default:t(()=>[e(f,{avatar:""},{default:t(()=>[e(v,{name:"location_on",color:"primary"})]),_:1}),e(f,null,{default:t(()=>[e(y,{caption:""},{default:t(()=>[c(n(l.$t("properties.location")),1)]),_:1}),e(y,null,{default:t(()=>[c(n(d.value?.location),1)]),_:1})]),_:1})]),_:1}),e(S,null,{default:t(()=>[e(f,{avatar:""},{default:t(()=>[e(v,{name:"attach_money",color:"primary"})]),_:1}),e(f,null,{default:t(()=>[e(y,{caption:""},{default:t(()=>[c(n(l.$t("properties.price")),1)]),_:1}),e(y,null,{default:t(()=>[c(n(d.value?.price),1)]),_:1})]),_:1})]),_:1})]),_:1})])]),e(le,{class:"q-my-md"}),s("div",null,[s("div",He,n(l.$t("properties.description")),1),s("p",null,n(d.value?.description),1)])]),_:1}),e(O,{align:"right"},{default:t(()=>[_(e(m,{color:"primary",icon:"edit",label:l.$t("properties.edit"),onClick:o[13]||(o[13]=a=>b(d.value))},null,8,["label"]),[[V]]),_(e(m,{color:"negative",icon:"delete",label:l.$t("properties.delete"),onClick:q},null,8,["label"]),[[V]]),_(e(m,{color:"green",icon:"phone",label:l.$t("properties.call"),onClick:o[14]||(o[14]=a=>J(d.value?.phoneNumber||"")),class:"call-btn"},null,8,["label"]),[[V]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(Y,{modelValue:p.value,"onUpdate:modelValue":o[16]||(o[16]=a=>p.value=a),persistent:""},{default:t(()=>[e(B,null,{default:t(()=>[e(L,{class:"row items-center"},{default:t(()=>[e(fe,{icon:"warning",color:"negative","text-color":"white"}),s("span",Je,n(l.$t("properties.confirmDelete")),1)]),_:1}),e(O,{align:"right"},{default:t(()=>[_(e(m,{flat:"",label:l.$t("common.cancel"),color:"primary"},null,8,["label"]),[[V]]),_(e(m,{flat:"",label:l.$t("common.yes"),color:"negative",onClick:D},null,8,["label"]),[[V]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{rl as default};
