import{ar as z,r as f,b as S,V as E,p as R,S as W,W as j,X as s,ab as n,Y as e,a3 as B,$ as d,Z as p,aj as k,ak as $,k as w,ap as x,au as O,aw as g,ag as A,az as X,aA as Z,ao as M,as as Y,a0 as G,a7 as H,a6 as J,a2 as K,am as tt,ad as h,at as q,ae as et,af as at,ai as ot,a4 as L,_ as P,aq as st,ah as lt}from"./index-D0a3PjNi.js";import{Q as nt}from"./QTooltip-BGagMJ-T.js";import{Q as rt}from"./QPage-BSv_0Jxy.js";import{u as ct}from"./use-quasar-BtzAyJjx.js";import{u as dt}from"./useFirestore-C2-a9jAw.js";import{u as it}from"./vue-i18n.runtime-Brl3r92v.js";import"./firebase-KNU8sfuI.js";const ut=z("contract",()=>{const b=f([]),i=f(!1),v=f(null),{getAll:u,getById:F,add:m,update:l,remove:C}=dt("contracts"),D=S(()=>b.value.length),U=S(()=>b.value.reduce((r,c)=>r+c.amount,0)),y=async()=>{i.value=!0;try{b.value=await u()}catch(r){console.error("Error loading contracts:",r),v.value="Failed to load contracts"}finally{i.value=!1}};return{contracts:b,loading:i,error:v,totalContracts:D,totalAmount:U,loadContracts:y,getContract:async r=>await F(r),addContract:async r=>{const c={...r,createdAt:new Date,updatedAt:new Date},t=await m(c);return t?(await y(),t):null},updateContract:async(r,c)=>{const t={...c,updatedAt:new Date},o=await l(r,t);return o&&await y(),o},deleteContract:async r=>{const c=await C(r);return c&&await y(),c},searchContracts:async r=>{i.value=!0;try{const c=await u();if(r){const t=r.toLowerCase();return c.filter(o=>o.firstParty.toLowerCase().includes(t)||o.secondParty.toLowerCase().includes(t)||o.description.toLowerCase().includes(t))}return c}catch(c){return console.error("Error searching contracts:",c),v.value="Failed to search contracts",[]}finally{i.value=!1}},getRecentContracts:async(r=5)=>{i.value=!0;try{return(await u()).sort((t,o)=>new Date(o.date).getTime()-new Date(t.date).getTime()).slice(0,r)}catch(c){return console.error("Error getting recent contracts:",c),v.value="Failed to get recent contracts",[]}finally{i.value=!1}}}}),mt={class:"q-mb-lg"},ft={class:"row justify-between items-center q-py-md"},pt={class:"text-h4 q-my-none"},vt={class:"text-h6"},yt={class:"row items-center justify-end"},Ct={class:"row q-col-gutter-md q-mb-lg"},wt={class:"col-12 col-md-6"},gt={class:"text-h6"},ht={class:"text-h3"},bt={class:"col-12 col-md-6"},_t={class:"text-h6"},Vt={class:"text-h3"},$t={class:"q-mb-md"},qt={key:0,class:"text-center q-pa-lg"},Pt={class:"text-subtitle1 q-mt-sm"},Dt={key:1,class:"q-mt-md"},Qt={class:"row items-start justify-between q-mb-sm"},kt={class:"col-9"},At={class:"col-3 text-right"},Lt={class:"row justify-end q-mt-sm"},St={class:"q-ml-sm"},Yt=E({__name:"ContractsPage",setup(b){const{t:i}=it(),v=ct(),u=f(!1),F=()=>{Q(),u.value=!0},m=ut();R(async()=>{await m.loadContracts()});const l=W({id:0,date:"",firstParty:"",secondParty:"",amount:0,description:""});f(""),f(!1);const C=f(""),D=S(()=>{if(!C.value)return m.contracts;const t=C.value.toLowerCase();return m.contracts.filter(o=>o.firstParty.toLowerCase().includes(t)||o.secondParty.toLowerCase().includes(t)||o.description.toLowerCase().includes(t))}),U=S(()=>m.totalAmount),y=t=>"$"+t.toLocaleString(),N=t=>new Date(t).toLocaleDateString(),T=async()=>{await m.addContract({date:l.date,firstParty:l.firstParty,secondParty:l.secondParty,amount:Number(l.amount),description:l.description})&&v.notify({color:"positive",message:i("contracts.contractAdded"),icon:"check"}),Q(),u.value=!1},Q=()=>{Object.assign(l,{id:0,date:"",firstParty:"",secondParty:"",amount:0,description:""})},I=()=>{Q(),u.value=!1},_=f(!1),V=f(null),r=t=>{V.value=t,_.value=!0},c=async()=>{V.value&&await m.deleteContract(V.value.id)&&v.notify({color:"positive",message:i("contracts.contractDeleted"),icon:"check"}),_.value=!1,V.value=null};return(t,o)=>(h(),j(rt,{padding:""},{default:s(()=>[n("div",mt,[n("div",ft,[n("h1",pt,d(t.$t("contracts.title")),1),e(p,{color:"primary",label:t.$t("contracts.addContract"),onClick:F,icon:"add",unelevated:""},null,8,["label"])])]),e(Y,{modelValue:u.value,"onUpdate:modelValue":o[6]||(o[6]=a=>u.value=a),persistent:""},{default:s(()=>[e(k,{style:{width:"600px","max-width":"90vw"}},{default:s(()=>[e($,{class:"row items-center"},{default:s(()=>[n("div",vt,d(t.$t("contracts.addContract")),1),e(x),w(e(p,{icon:"close",flat:"",round:"",dense:"",onClick:I},null,512),[[q]])]),_:1}),e($,{class:"q-pt-none"},{default:s(()=>[e(O,{onSubmit:T,class:"q-gutter-md"},{default:s(()=>[e(g,{modelValue:l.date,"onUpdate:modelValue":o[1]||(o[1]=a=>l.date=a),label:t.$t("contracts.contractDate")+" *",outlined:"",readonly:"",rules:[a=>!!a||t.$t("common.required")]},{append:s(()=>[e(A,{name:"event",class:"cursor-pointer"},{default:s(()=>[e(X,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:s(()=>[e(Z,{modelValue:l.date,"onUpdate:modelValue":o[0]||(o[0]=a=>l.date=a),mask:"YYYY-MM-DD"},{default:s(()=>[n("div",yt,[w(e(p,{label:"Close",color:"primary",flat:""},null,512),[[q]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","label","rules"]),e(g,{modelValue:l.firstParty,"onUpdate:modelValue":o[2]||(o[2]=a=>l.firstParty=a),label:t.$t("contracts.firstParty")+" *",outlined:"",rules:[a=>!!a||t.$t("common.required")]},null,8,["modelValue","label","rules"]),e(g,{modelValue:l.secondParty,"onUpdate:modelValue":o[3]||(o[3]=a=>l.secondParty=a),label:t.$t("contracts.secondParty")+" *",outlined:"",rules:[a=>!!a||t.$t("common.required")]},null,8,["modelValue","label","rules"]),e(g,{modelValue:l.amount,"onUpdate:modelValue":o[4]||(o[4]=a=>l.amount=a),modelModifiers:{number:!0},label:t.$t("contracts.contractAmount")+" *",outlined:"",type:"number",rules:[a=>!!a||t.$t("common.required"),a=>a>0||t.$t("common.invalidNumber")]},null,8,["modelValue","label","rules"]),e(g,{modelValue:l.description,"onUpdate:modelValue":o[5]||(o[5]=a=>l.description=a),label:t.$t("contracts.description"),outlined:"",type:"textarea",rows:"3"},null,8,["modelValue","label"])]),_:1})]),_:1}),e(M,{align:"right"},{default:s(()=>[w(e(p,{label:t.$t("common.cancel"),color:"grey-7",flat:"",onClick:I},null,8,["label"]),[[q]]),e(p,{label:t.$t("common.save"),color:"primary",onClick:T,unelevated:""},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n("div",Ct,[n("div",wt,[e(k,{class:"bg-primary text-white"},{default:s(()=>[e($,null,{default:s(()=>[n("div",gt,d(t.$t("contracts.totalContracts")),1),n("div",ht,d(G(m).contracts.length),1)]),_:1})]),_:1})]),n("div",bt,[e(k,{class:"bg-secondary text-white"},{default:s(()=>[e($,null,{default:s(()=>[n("div",_t,d(t.$t("contracts.totalAmount")),1),n("div",Vt,d(y(U.value)),1)]),_:1})]),_:1})])]),n("div",$t,[e(g,{modelValue:C.value,"onUpdate:modelValue":o[7]||(o[7]=a=>C.value=a),placeholder:t.$t("common.search"),outlined:"",dense:"",clearable:""},{append:s(()=>[e(A,{name:"search"})]),_:1},8,["modelValue","placeholder"])]),D.value.length===0?(h(),B("div",qt,[e(A,{name:"description",size:"4rem",color:"grey-5"}),n("p",Pt,d(t.$t("common.noResults")),1)])):(h(),B("div",Dt,[e(K,{class:"q-pa-none"},{default:s(()=>[(h(!0),B(H,null,J(D.value,a=>w((h(),j(et,{key:a.id,class:"contract-item q-pa-md q-mb-md",clickable:""},{default:s(()=>[e(at,null,{default:s(()=>[n("div",Qt,[n("div",kt,[e(L,{class:"contract-parties"},{default:s(()=>[P(d(a.firstParty)+" & "+d(a.secondParty),1)]),_:2},1024),e(L,{class:"contract-date q-mt-xs"},{default:s(()=>[e(A,{name:"event",size:"xs",class:"q-mr-xs"}),P(" "+d(N(a.date)),1)]),_:2},1024)]),n("div",At,[e(L,{class:"contract-amount"},{default:s(()=>[P(d(y(a.amount)),1)]),_:2},1024)])]),a.description?(h(),j(L,{key:0,class:"contract-description"},{default:s(()=>[P(d(a.description),1)]),_:2},1024)):ot("",!0),n("div",Lt,[e(p,{flat:"",round:"",color:"negative",icon:"delete",onClick:st(Ft=>r(a),["stop"]),size:"sm"},{default:s(()=>[e(nt,null,{default:s(()=>[P(d(t.$t("contracts.delete")),1)]),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)),[[lt]])),128))]),_:1})])),e(Y,{modelValue:_.value,"onUpdate:modelValue":o[8]||(o[8]=a=>_.value=a),persistent:""},{default:s(()=>[e(k,null,{default:s(()=>[e($,{class:"row items-center"},{default:s(()=>[e(tt,{icon:"warning",color:"negative","text-color":"white"}),n("span",St,d(t.$t("contracts.confirmDelete")),1)]),_:1}),e(M,{align:"right"},{default:s(()=>[w(e(p,{flat:"",label:t.$t("common.cancel"),color:"primary"},null,8,["label"]),[[q]]),w(e(p,{flat:"",label:t.$t("common.yes"),color:"negative",onClick:c},null,8,["label"]),[[q]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Yt as default};
