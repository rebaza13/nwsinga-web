import{ar as ue,r as V,b as y,V as re,p as ie,S as ce,W as Z,X as l,ab as d,Y as a,a3 as S,$ as i,Z as D,aj as U,ak as k,k as $,ap as me,au as be,aw as q,ag as Q,az as G,aA as H,av as z,ao as J,as as K,a0 as fe,a7 as pe,a6 as ve,a2 as De,am as ye,ad as _,at as N,ae as ge,af as he,a4 as E,_ as I,ai as B,a5 as _e,aq as ee,ah as Ve}from"./index-D0a3PjNi.js";import{Q as we}from"./QBadge-Bt5SIest.js";import{Q as te}from"./QTooltip-BGagMJ-T.js";import{Q as $e}from"./QPage-BSv_0Jxy.js";import{u as qe}from"./use-quasar-BtzAyJjx.js";import{c as ae,d as P,q as Qe,o as Ie,g as Ce,a as T,b as Se,e as ke,s as R,u as Ne,f as Ue}from"./firebase-KNU8sfuI.js";import{u as Pe}from"./vue-i18n.runtime-Brl3r92v.js";import{_ as Ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Fe=ue("debt",()=>{const g=V([]),r=V(!1),m=V(null),p=async()=>{r.value=!0,m.value=null;try{const n=ae(P,"debts"),u=Qe(n,Ie("date","desc")),b=await Ce(u),c=[];b.forEach(w=>{const f=w.data();c.push({id:w.id,debtorName:f.debtorName,date:f.date,dueDate:f.dueDate||"",amount:f.amount,currency:f.currency,contactInfo:f.contactInfo||"",description:f.description||"",status:f.status,createdAt:f.createdAt?.toDate(),updatedAt:f.updatedAt?.toDate()})}),g.value=c}catch(n){console.error("Error loading debts:",n),m.value="Failed to load debts"}finally{r.value=!1}},O=async n=>{try{const u=T(P,"debts",n),b=await Se(u);if(b.exists()){const c=b.data();return{id:b.id,debtorName:c.debtorName,date:c.date,dueDate:c.dueDate||"",amount:c.amount,currency:c.currency,contactInfo:c.contactInfo||"",description:c.description||"",status:c.status,createdAt:c.createdAt?.toDate(),updatedAt:c.updatedAt?.toDate()}}return null}catch(u){return console.error("Error getting debt:",u),m.value="Failed to get debt",null}},v=async n=>{r.value=!0,m.value=null;try{const u=ae(P,"debts"),b=await ke(u,{...n,amount:Number(n.amount),createdAt:R(),updatedAt:R()});return await p(),b.id}catch(u){return console.error("Error adding debt:",u),m.value="Failed to add debt",null}finally{r.value=!1}},L=async(n,u)=>{r.value=!0,m.value=null;try{const b=T(P,"debts",n);return u.amount&&(u.amount=Number(u.amount)),await Ne(b,{...u,updatedAt:R()}),await p(),!0}catch(b){return console.error("Error updating debt:",b),m.value="Failed to update debt",!1}finally{r.value=!1}},A=async n=>{r.value=!0,m.value=null;try{const u=T(P,"debts",n);return await Ue(u),await p(),!0}catch(u){return console.error("Error deleting debt:",u),m.value="Failed to delete debt",!1}finally{r.value=!1}},Y=y(()=>g.value.length),M=y(()=>g.value.filter(n=>n.currency==="USD").reduce((n,u)=>n+u.amount,0)),o=y(()=>g.value.filter(n=>n.currency==="IQD").reduce((n,u)=>n+u.amount,0)),C=y(()=>g.value.filter(n=>n.status==="Pending"||n.status==="Partial")),h=y(()=>g.value.filter(n=>n.status==="Overdue"));return{debts:g,loading:r,error:m,loadDebts:p,getDebt:O,addDebt:v,updateDebt:L,deleteDebt:A,totalDebts:Y,totalAmountUSD:M,totalAmountIQD:o,pendingDebts:C,overdueDebts:h}}),je={class:"q-mb-lg"},Ee={class:"row justify-between items-center q-py-md"},Oe={class:"text-h4 q-my-none"},Le={class:"text-h6"},Ye={class:"row items-center justify-end"},Me={class:"row items-center justify-end"},xe={class:"row q-col-gutter-md q-mb-lg"},ze={class:"col-12 col-md-4"},Be={class:"text-h6"},Te={class:"text-h3"},Re={class:"col-12 col-md-4"},We={class:"text-h6"},Xe={class:"text-h3"},Ze={class:"col-12 col-md-4"},Ge={class:"text-h6"},He={class:"text-h3"},Je={class:"row q-col-gutter-md q-mb-md"},Ke={class:"col-12 col-md-8"},et={class:"col-12 col-md-4"},tt={key:0,class:"text-center q-pa-lg"},at={class:"text-subtitle1 q-mt-sm"},st={key:1,class:"q-mt-md"},ot={class:"row items-start justify-between q-mb-sm"},lt={class:"col-8"},nt={key:0},dt={class:"col-4 text-right"},ut={class:"text-h6 text-weight-bold q-mt-sm"},rt={class:"row q-col-gutter-sm"},it={key:0,class:"col-12"},ct={key:1,class:"col-12"},mt={class:"row justify-end q-mt-md"},bt={class:"q-ml-sm"},ft=re({__name:"DebtsPage",setup(g){const{t:r}=Pe(),m=qe(),p=V(!1),O=()=>{x(),p.value=!0},v=Fe();ie(async()=>{await v.loadDebts()});const L=[{label:"USD ($)",value:"USD"},{label:"IQD",value:"IQD"}],A=[{label:r("debts.statusPending"),value:"Pending"},{label:r("debts.statusPartial"),value:"Partial"},{label:r("debts.statusPaid"),value:"Paid"},{label:r("debts.statusOverdue"),value:"Overdue"}],Y={Pending:r("debts.statusPending"),Partial:r("debts.statusPartial"),Paid:r("debts.statusPaid"),Overdue:r("debts.statusOverdue")},M=y(()=>[{label:r("common.all"),value:""},...A]),o=ce({id:"",debtorName:"",date:"",dueDate:"",amount:0,currency:"USD",contactInfo:"",description:"",status:"Pending",isEditing:!1}),C=V(""),h=V(""),n=y(()=>{let e=[...v.debts];if(C.value){const s=C.value.toLowerCase();e=e.filter(t=>t.debtorName.toLowerCase().includes(s)||t.description&&t.description.toLowerCase().includes(s)||t.contactInfo&&t.contactInfo.toLowerCase().includes(s))}return h.value&&h.value!==""&&(console.log("Filtering by status:",h.value),e=e.filter(s=>(typeof s.status=="object"&&s.status?s.status.value:s.status)===h.value)),e}),u=y(()=>v.debts.filter(e=>e.currency==="USD").reduce((e,s)=>e+s.amount,0)),b=y(()=>v.debts.filter(e=>e.currency==="IQD").reduce((e,s)=>e+s.amount,0)),c=(e,s)=>s==="USD"?"$"+w(e):w(e)+" IQD",w=e=>e.toLocaleString(),f=e=>e?new Date(e).toLocaleDateString():"",se=e=>{switch(typeof e=="object"?e?.value:e){case"Paid":return"positive";case"Partial":return"warning";case"Overdue":return"negative";default:return"blue"}},W=async()=>{const e=typeof o.status=="object"&&o.status?o.status.value:o.status;o.isEditing?await v.updateDebt(o.id,{debtorName:o.debtorName,date:o.date,dueDate:o.dueDate,amount:Number(o.amount),currency:o.currency,contactInfo:o.contactInfo,description:o.description,status:e})&&m.notify({color:"positive",message:r("debts.debtUpdated"),icon:"check"}):await v.addDebt({debtorName:o.debtorName,date:o.date,dueDate:o.dueDate,amount:Number(o.amount),currency:o.currency,contactInfo:o.contactInfo,description:o.description,status:e})&&m.notify({color:"positive",message:r("debts.debtAdded"),icon:"check"}),x(),p.value=!1},oe=e=>{Object.assign(o,{...e,isEditing:!0}),p.value=!0},x=()=>{Object.assign(o,{id:"",debtorName:"",date:"",dueDate:"",amount:0,currency:"USD",contactInfo:"",description:"",status:"Pending",isEditing:!1})},X=()=>{x(),p.value=!1},F=V(!1),j=V(null),le=e=>{j.value=e,F.value=!0},ne=async()=>{j.value&&await v.deleteDebt(j.value.id)&&m.notify({color:"positive",message:r("debts.debtDeleted"),icon:"check"}),F.value=!1,j.value=null};return(e,s)=>(_(),Z($e,{padding:""},{default:l(()=>[d("div",je,[d("div",Ee,[d("h1",Oe,i(e.$t("debts.title")),1),a(D,{color:"primary",label:e.$t("debts.addDebt"),onClick:O,icon:"add",unelevated:""},null,8,["label"])])]),a(K,{modelValue:p.value,"onUpdate:modelValue":s[10]||(s[10]=t=>p.value=t),persistent:""},{default:l(()=>[a(U,{style:{width:"600px","max-width":"90vw"}},{default:l(()=>[a(k,{class:"row items-center"},{default:l(()=>[d("div",Le,i(e.$t("debts.addDebt")),1),a(me),$(a(D,{icon:"close",flat:"",round:"",dense:"",onClick:X},null,512),[[N]])]),_:1}),a(k,{class:"q-pt-none"},{default:l(()=>[a(be,{onSubmit:W,class:"q-gutter-md"},{default:l(()=>[a(q,{modelValue:o.debtorName,"onUpdate:modelValue":s[0]||(s[0]=t=>o.debtorName=t),label:e.$t("debts.debtorName")+" *",outlined:"",rules:[t=>!!t||e.$t("common.required")]},null,8,["modelValue","label","rules"]),a(q,{modelValue:o.date,"onUpdate:modelValue":s[2]||(s[2]=t=>o.date=t),label:e.$t("debts.debtDate")+" *",outlined:"",readonly:"",rules:[t=>!!t||e.$t("common.required")]},{append:l(()=>[a(Q,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(G,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(H,{modelValue:o.date,"onUpdate:modelValue":s[1]||(s[1]=t=>o.date=t),mask:"YYYY-MM-DD"},{default:l(()=>[d("div",Ye,[$(a(D,{label:"Close",color:"primary",flat:""},null,512),[[N]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","label","rules"]),a(q,{modelValue:o.dueDate,"onUpdate:modelValue":s[4]||(s[4]=t=>o.dueDate=t),label:e.$t("debts.dueDate"),outlined:"",readonly:""},{append:l(()=>[a(Q,{name:"event",class:"cursor-pointer"},{default:l(()=>[a(G,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:l(()=>[a(H,{modelValue:o.dueDate,"onUpdate:modelValue":s[3]||(s[3]=t=>o.dueDate=t),mask:"YYYY-MM-DD"},{default:l(()=>[d("div",Me,[$(a(D,{label:"Close",color:"primary",flat:""},null,512),[[N]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue","label"]),a(q,{modelValue:o.amount,"onUpdate:modelValue":s[5]||(s[5]=t=>o.amount=t),modelModifiers:{number:!0},label:e.$t("debts.amount")+" *",outlined:"",type:"number",rules:[t=>!!t||e.$t("common.required"),t=>t>0||e.$t("common.invalidNumber")]},null,8,["modelValue","label","rules"]),a(z,{modelValue:o.currency,"onUpdate:modelValue":s[6]||(s[6]=t=>o.currency=t),options:L,label:e.$t("debts.currency")+" *",outlined:"",rules:[t=>!!t||e.$t("common.required")]},null,8,["modelValue","label","rules"]),a(q,{modelValue:o.contactInfo,"onUpdate:modelValue":s[7]||(s[7]=t=>o.contactInfo=t),label:e.$t("debts.contactInfo"),outlined:""},null,8,["modelValue","label"]),a(q,{modelValue:o.description,"onUpdate:modelValue":s[8]||(s[8]=t=>o.description=t),label:e.$t("debts.description"),outlined:"",type:"textarea",rows:"3"},null,8,["modelValue","label"]),a(z,{modelValue:o.status,"onUpdate:modelValue":s[9]||(s[9]=t=>o.status=t),options:A,label:e.$t("debts.status")+" *",outlined:"",rules:[t=>!!t||e.$t("common.required")]},null,8,["modelValue","label","rules"])]),_:1})]),_:1}),a(J,{align:"right"},{default:l(()=>[$(a(D,{label:e.$t("common.cancel"),color:"grey-7",flat:"",onClick:X},null,8,["label"]),[[N]]),a(D,{label:e.$t("common.save"),color:"primary",onClick:W,unelevated:""},null,8,["label"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),d("div",xe,[d("div",ze,[a(U,{class:"bg-primary text-white"},{default:l(()=>[a(k,null,{default:l(()=>[d("div",Be,i(e.$t("debts.totalDebts")),1),d("div",Te,i(fe(v).debts.length),1)]),_:1})]),_:1})]),d("div",Re,[a(U,{class:"bg-secondary text-white"},{default:l(()=>[a(k,null,{default:l(()=>[d("div",We,i(e.$t("debts.totalAmountUSD")),1),d("div",Xe,"$"+i(w(u.value)),1)]),_:1})]),_:1})]),d("div",Ze,[a(U,{class:"bg-accent text-white"},{default:l(()=>[a(k,null,{default:l(()=>[d("div",Ge,i(e.$t("debts.totalAmountIQD")),1),d("div",He,i(w(b.value))+" IQD",1)]),_:1})]),_:1})])]),d("div",Je,[d("div",Ke,[a(q,{modelValue:C.value,"onUpdate:modelValue":s[11]||(s[11]=t=>C.value=t),placeholder:e.$t("common.search"),outlined:"",dense:"",clearable:""},{append:l(()=>[a(Q,{name:"search"})]),_:1},8,["modelValue","placeholder"])]),d("div",et,[a(z,{modelValue:h.value,"onUpdate:modelValue":s[12]||(s[12]=t=>h.value=t),options:M.value,label:e.$t("debts.status"),outlined:"",dense:"","option-label":"label","option-value":"value","map-options":""},null,8,["modelValue","options","label"])])]),n.value.length===0?(_(),S("div",tt,[a(Q,{name:"money_off",size:"4rem",color:"grey-5"}),d("p",at,i(e.$t("common.noResults")),1)])):(_(),S("div",st,[a(De,{class:"q-pa-none"},{default:l(()=>[(_(!0),S(pe,null,ve(n.value,t=>$((_(),Z(ge,{key:t.id,class:"debt-item q-mb-md",clickable:""},{default:l(()=>[a(he,null,{default:l(()=>[d("div",ot,[d("div",lt,[a(E,{class:"text-h6"},{default:l(()=>[I(i(t.debtorName),1)]),_:2},1024),a(E,{caption:"",class:"q-mt-xs"},{default:l(()=>[a(Q,{name:"event",size:"xs",class:"q-mr-xs"}),I(" "+i(f(t.date))+" ",1),t.dueDate?(_(),S("span",nt," - "+i(e.$t("debts.due"))+": "+i(f(t.dueDate)),1)):B("",!0)]),_:2},1024)]),d("div",dt,[a(we,{color:se(t.status),class:"q-mb-sm"},{default:l(()=>[I(i(typeof t.status=="object"?t.status.label:Y[t.status]||t.status),1)]),_:2},1032,["color"]),d("div",ut,i(c(t.amount,t.currency)),1)])]),a(_e,{class:"q-my-sm"}),d("div",rt,[t.description?(_(),S("div",it,[a(E,{class:"text-body2"},{default:l(()=>[a(Q,{name:"description",size:"xs",class:"q-mr-xs"}),I(" "+i(t.description),1)]),_:2},1024)])):B("",!0),t.contactInfo?(_(),S("div",ct,[a(E,{caption:""},{default:l(()=>[a(Q,{name:"phone",size:"xs",class:"q-mr-xs"}),I(" "+i(t.contactInfo),1)]),_:2},1024)])):B("",!0)]),d("div",mt,[a(D,{flat:"",round:"",color:"primary",icon:"edit",onClick:ee(de=>oe(t),["stop"]),class:"q-mr-xs",size:"sm"},{default:l(()=>[a(te,null,{default:l(()=>[I(i(e.$t("common.edit")),1)]),_:1})]),_:2},1032,["onClick"]),a(D,{flat:"",round:"",color:"negative",icon:"delete",onClick:ee(de=>le(t),["stop"]),size:"sm"},{default:l(()=>[a(te,null,{default:l(()=>[I(i(e.$t("common.delete")),1)]),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024)),[[Ve]])),128))]),_:1})])),a(K,{modelValue:F.value,"onUpdate:modelValue":s[13]||(s[13]=t=>F.value=t),persistent:""},{default:l(()=>[a(U,null,{default:l(()=>[a(k,{class:"row items-center"},{default:l(()=>[a(ye,{icon:"warning",color:"negative","text-color":"white"}),d("span",bt,i(e.$t("debts.confirmDelete")),1)]),_:1}),a(J,{align:"right"},{default:l(()=>[$(a(D,{flat:"",label:e.$t("common.cancel"),color:"primary"},null,8,["label"]),[[N]]),$(a(D,{flat:"",label:e.$t("common.yes"),color:"negative",onClick:ne},null,8,["label"]),[[N]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),wt=Ae(ft,[["__scopeId","data-v-1bc41762"]]);export{wt as default};
